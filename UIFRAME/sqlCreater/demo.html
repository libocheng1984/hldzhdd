<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
<!--<script src="../Scripts/jquery-2.1.4.min.js"></script>-->
<script src="../Scripts/jquery-1.11.3.min.js"></script>

<script src="../Scripts/json2-min.js"></script>
<script src="../comfun/comaction.js"></script>
<script src="../frame/Request.js"></script>
<script src="../Scripts/ajaxfileupload.js"></script>
<script src="../formItem/uploadObj.js"></script>
<script src="../frame/mp3Player.js"></script>
<script src="../Mdatepicker/MdateTimePicker.js"></script>
<script src="../Mdatepicker/MdateTimePartSelector.js"></script>
<script src="../Messager/messager.js"></script>

<script src="../formItem/formDeal.js"></script>
<script src="../formItem/formFunction.js"></script>
<script src="../formItem/formFormat.js"></script>
<script src="../formItem/FormItemAction.js"></script>

<script src="sqlCreator.js"></script>
<script>
//浏览器判断
var browserIsIE=(navigator.userAgent.indexOf("MSIE")>0 || navigator.userAgent.indexOf("Trident")>0); //IE11 "Trident"
var browserIsIE6=(navigator.userAgent.indexOf("MSIE 6")>0);
var browserIsIE7=(navigator.userAgent.indexOf("MSIE 7")>0);
var browserIsIE8=(navigator.userAgent.indexOf("MSIE 8")>0);
var browserIsIE9=(navigator.userAgent.indexOf("MSIE 9")>0); 
var browserIsOpera=(navigator.userAgent.indexOf('Opera')>0);

/*var datalist={ "code":"1", "msg":"OK", "exp":"OK", 
		"data":[ { "code":"055", "label":"珞巴族" }, { "code":"004", "label":"藏族" }, { "code":"038", "label":"锡伯族" }, { "code":"041", "label":"塔吉克族" }, { "code":"020", "label":"傈僳族" }, { "code":"037", "label":"仡佬族" }, { "code":"040", "label":"普米族" }, { "code":"034", "label":"布朗族" }, { "code":"017", "label":"哈萨克族" }, { "code":"024", "label":"拉祜族" }, { "code":"052", "label":"鄂伦春族" }, { "code":"021", "label":"佤族" }, { "code":"033", "label":"羌族" }, { "code":"018", "label":"傣族" }, { "code":"025", "label":"水族" }, { "code":"003", "label":"回族" }, { "code":"050", "label":"塔塔尔族" }, { "code":"048", "label":"裕固族" }, { "code":"015", "label":"土家族" }, { "code":"047", "label":"保安族" }, { "code":"002", "label":"蒙古族" }, { "code":"043", "label":"乌孜别克族" }, { "code":"006", "label":"苗族" }, { "code":"011", "label":"满族" }, { "code":"039", "label":"阿昌族" }, { "code":"054", "label":"门巴族" }, { "code":"058", "label":"外国血统" }, { "code":"046", "label":"崩龙族" }, { "code":"028", "label":"景颇族" }, { "code":"042", "label":"怒族" }, { "code":"007", "label":"彝族" }, { "code":"012", "label":"侗族" }, { "code":"016", "label":"哈尼族" }, { "code":"049", "label":"京族" }, { "code":"013", "label":"瑶族" }, { "code":"056", "label":"基诺族" }, { "code":"045", "label":"鄂温克族" }, { "code":"044", "label":"俄罗斯族" }, { "code":"030", "label":"土族" }, { "code":"057", "label":"其他" }, { "code":"053", "label":"赫哲族" }, { "code":"008", "label":"壮族" }, { "code":"014", "label":"白族" }, { "code":"009", "label":"布依族" }, { "code":"010", "label":"朝鲜族" }, { "code":"019", "label":"黎族" }, { "code":"026", "label":"东乡族" }, { "code":"022", "label":"畲族" }, { "code":"051", "label":"独龙族" }, { "code":"036", "label":"毛难族" }, { "code":"032", "label":"仫佬族" }, { "code":"023", "label":"高山族" }, { "code":"035", "label":"撒拉族" }, { "code":"031", "label":"达斡尔族" }, { "code":"029", "label":"柯尔克孜族" }, { "code":"027", "label":"纳西族" }, { "code":"005", "label":"维吾尔族" }, { "code":"001", "label":"汉族" } ], 
		"datalen":58, 
		"total":58 
}*/


/*{
 "DataSourceDefinition":{
 "xmlns":"http://www.liaoningpolice.gov.cn/schema/technology/complexquery/ComplexQueryDataSource/v001",
 "name":"hotel_guest_checkin",
 "label":"旅客住店登记信息",
 "documentation":"旅客住店登记后由旅店上传的入住、退房记录",
 "SQLStatement":"select lkdjbm,qyjbqymc,lkdjxm,xbdm,lkdjcsrq,gjdm,rylxdm,mzdm,zjlxdm,\n lkdjzjhm,dzqhdm,lkdjzjxz,lkdjrzsj,lkdjrzfh,lkdjcssj,lkdjtfsj,\n gabmdm,gabm_class_link_mixed_bm,rzsj\nfrom hotel_less_hdfs_v3\nwhere %%c

onditiongroup%%%",
 "DataSetName":"hotel_less_hdfs_v3",
 "ConditionGroup":[
 {
 "name":"conditiongroup",
 "label":"查询条件组合",
 "documentation":"用于生成组合查询条件的选项列表",
 "LogicCondition":[
 {
 "name":"lkdjbm",
 "label":"旅客登记编号",
 "type":{
 "name":"string"
 }
 },
 {
 "name":"qyjbqymc",
 "label":"酒店名称",
 "type":{
 "name":"string"
 }
 },
 {
 "name":"lkdjxm",
 "label":"旅客登记姓名",
 "type":{
 "name":"string"
 }
 },
 {
 "name":"lkdjzjhm",
 "label":"旅客登记证件号码",
 "type":{
 "name":"string"
 }
 },
 {
 "name":"gabmdm",
 "label":"公安部门代码",
 "type":{
 "name":"string"
 }
 },
 {
 "name":"xbdm",
 "label":"性别",
 "type":{
 "name":"string"
 },
 "selection":{
 "category":"XB",
 "version":""
 }
 },
 {
 "name":"gjdm",
 "label":"国籍",
 "type":{
 "name":"string"
 },
 "selection":{
 "category":"GJ",
 "version":""
 }
 },
 {
 "name":"mzdm",
 "label":"民族",
 "type":{
 "name":"string"
 },
 "selection":{
 "category":"MZ",
 "version":""
 }
 }
 ]
 }
 ]
 }
}*/

var dataSource={ "code":"1", "msg":"OK", "exp":"OK", "data":[ { "DataSourceName":"hotel_guest_checkin", "DataSourceLabel":"旅客住店登记信息", "Description":"旅客住店登记后由旅店上传的入住、退房记录", "JsonString":"{\n \"DataSourceDefinition\":{\n \"xmlns\":\"http://www.liaoningpolice.gov.cn/schema/technology/complexquery/ComplexQueryDataSource/v001\",\n \"name\":\"hotel_guest_checkin\",\n \"label\":\"旅客住店登记信息\",\n \"documentation\":\"旅客住店登记后由旅店上传的入住、退房记录\",\n \"SQLStatement\":\"select lkdjbm,qyjbqymc,lkdjxm,xbdm,lkdjcsrq,gjdm,rylxdm,mzdm,zjlxdm,\\n lkdjzjhm,dzqhdm,lkdjzjxz,lkdjrzsj,lkdjrzfh,lkdjcssj,lkdjtfsj,\\n gabmdm,gabm_class_link_mixed_bm,rzsj\\nfrom hotel_less_hdfs_v3\\nwhere %%%conditiongroup%%%\",\n \"DataSetName\":\"hotel_less_hdfs_v3\",\n \"ConditionGroup\":[\n {\n \"name\":\"conditiongroup\",\n \"label\":\"查询条件组合\",\n \"documentation\":\"用于生成组合查询条件的选项列表\",\n \"LogicCondition\":[\n {\n \"name\":\"lkdjbm\",\n \"label\":\"旅客登记编号\",\n \"type\":{\n \"name\":\"string\"\n }\n },\n {\n \"name\":\"qyjbqymc\",\n \"label\":\"酒店名称\",\n \"type\":{\n \"name\":\"string\"\n }\n },\n {\n \"name\":\"lkdjxm\",\n \"label\":\"旅客登记姓名\",\n \"type\":{\n \"name\":\"string\"\n }\n },\n {\n \"name\":\"lkdjzjhm\",\n \"label\":\"旅客登记证件号码\",\n \"type\":{\n \"name\":\"string\"\n }\n },\n {\n \"name\":\"gabmdm\",\n \"label\":\"公安部门代码\",\n \"type\":{\n \"name\":\"string\"\n }\n },\n {\n \"name\":\"xbdm\",\n \"label\":\"性别\",\n \"type\":{\n \"name\":\"string\"\n },\n \"selection\":{\n \"category\":\"XB\",\n \"version\":\"\"\n }\n },\n {\n \"name\":\"gjdm\",\n \"label\":\"国籍\",\n \"type\":{\n \"name\":\"string\"\n },\n \"selection\":{\n \"category\":\"GJ\",\n \"version\":\"\"\n }\n },\n {\n \"name\":\"mzdm\",\n \"label\":\"民族\",\n \"type\":{\n \"name\":\"string\"\n },\n \"selection\":{\n \"category\":\"MZ\",\n \"version\":\"\"\n }\n }\n ]\n }\n ]\n }\n}" } ], "datalen":1, "total":1 }

var SQL;
$(function(){
	var dataSourceJson=JSON.parse(dataSource["data"][0]["JsonString"].replace(/\\n/g,""));	
	var dataSet=formatOption(dataSourceJson["DataSourceDefinition"]["ConditionGroup"][0]["LogicCondition"]);	

	SQL=new SqlCreator($(".sqlcontainer"));	
	SQL.option["datasource"]=dataSourceJson;
	SQL.install();
	SQL.load(dataSet);
	
	$("#export").bind("click",function(){
		console.log(SQL.getRealSQL());
	})
})

//格式化对照关系
function formatOption(dataSetArray){
	var dataSetOption=[];
	for(var i=0;i<dataSetArray.length;i++){
		var clum={};		
		clum["label"]=dataSetArray[i]["label"];
		clum["value"]=dataSetArray[i]["name"];
		clum["type"]=clum["show"]=dataSetArray[i]["type"]["name"];
		if(dataSetArray[i]["selection"]){
			clum["show"]="select";
			//clum["url"]='/host/bigdatadatalist.asp?content={"data":[{"category":"'+dataSetArray[i]["selection"]["category"]+'"}] }';  //格式化字典数据接口
			clum["url"]='/host/bigdatadatalist.asp?content='+dataSetArray[i]["selection"]["category"];  //格式化字典数据接口
		}
		dataSetOption.push(clum);
	}
	console.log(dataSetOption)
	return dataSetOption;
}
</script>

<style type="text/css">

.sqlcontainer {
	height: 700px;
	width: 1000px;
	background-color: #FFF;
}

</style>
<link href="../formItem/formitem.css" rel="stylesheet" type="text/css">
<link href="../Mdatepicker/Mpicker.css" rel="stylesheet" type="text/css">
<link href="../Messager/messager.css" rel="stylesheet" type="text/css">
<link href="../style/comstyle.css" rel="stylesheet" type="text/css">
<link href="sqlCreator.css" rel="stylesheet" type="text/css">
</head>

<body>

<div class="sqlcontainer"></div>
<a id="export">导出SQL</a>

</body>
</html>
