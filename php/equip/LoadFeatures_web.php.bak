<?php
	header('Content-Type: text/html; charset=UTF-8');
	header("Expires: 0");
	header("Cache-Control: no-cache" );
	header("Pragma content: no-cache");
	session_start();
	session_commit();
?>
<?php
/**
 * 功能：平台查询预案列表
 * 	{head:{code:1/0,message=""},value:{},extend:""}
 */
	include_once('../GlobalConfig.class.php');
	include_once('../class/TpmsDB.class.php');
	include_once('../class/Equip.class.php');
	
	/*登陆超时校验*/
	if (!isset ($_SESSION["userId"])) {
	$arr = array (
		'head' => array (
					'code' => 9,
					'message' => '登录超时'
					),
		'value' => '',
		'extend' => ''
	);
		die(encodeJson($arr));
	}
	
	/*查询*/
	/*传入参数*/
	$interfaceUrl = GlobalConfig :: getInstance()->interfaceUrl;
	$license = GlobalConfig :: getInstance()->license;
	$params = 'operation=OrgManagement_GetAdminAreaByAccount_v002&license=' . $license.'&content=';
	$event = isset ($_REQUEST['event']) ? $_REQUEST['event'] : "";
	$content = isset ($_REQUEST['content']) ? $_REQUEST['content'] : "";
	$extend = isset ($_REQUEST['extend']) ? $_REQUEST['extend'] : "";
	$content = Json_decode($content,true);
	$userId="";
	if(isset($content['condition'])){
		$userId = isset($content['condition']['userId'])?$content['condition']['userId']:$_SESSION["userId"];
	}

		
	/*调试*/
	if (isDebug()) {
		$page=1;
		$rows=10;
	}
	
	if ($userId=="") {
		$arr = array (
				'head' => array (
					'code' => 0,
					'message' => '缺少参数!!'
				),
				'value' => '',
				'extend' => ''
			);
		die(encodeJson($arr));
	}
	
	$equip = new Equip();//创建调度类实例
	$res = $equip->loadFeautures($interfaceUrl,$params,$userId);//调用实例方法
	//$res = '{ "code":"1", "msg":"查询成功！", "exp":null, "data":[ { "AdminArea":"121.618653294000,38.905696969000,121.618397831000,38.906232224000,121.617628563000,38.906016769000,121.617318751000,38.906506994000,121.617313751000,38.906515994000,121.617037750000,38.906952987000,121.616511750000,38.907826970000,121.616029176000,38.907620443000,121.615843841000,38.907531566000,121.615026764000,38.908703949000,121.614571762000,38.909561934000,121.614171759000,38.910586918000,121.614016757000,38.910997911000,121.613888755000,38.911335905000,121.613705753000,38.911817897000,121.613220748000,38.913097875000,121.612566737000,38.914824896000,121.612532154000,38.914813369000,121.611815171000,38.914610318000,121.611465177000,38.914524318000,121.611191181000,38.914453316000,121.610998185000,38.914403317000,121.610357196000,38.914241315000,121.609494726000,38.913985555000,121.609441165000,38.913969672000,121.609433716000,38.913967462000,121.609430198000,38.913966419000,121.607768242000,38.913473311000,121.607707244000,38.913454311000,121.607409249000,38.913366309000,121.606276269000,38.913030308000,121.605465283000,38.912789306000,121.604787295000,38.912628304000,121.604013308000,38.912445303000,121.603702315000,38.912371302000,121.603271322000,38.912275300000,121.601740347000,38.911932295000,121.601926350000,38.911420304000,121.602052351000,38.911074310000,121.602183352000,38.910716317000,121.602222353000,38.910611318000,121.602383355000,38.910181325000,121.602523356000,38.909807331000,121.602559357000,38.909711332000,121.602685358000,38.909416338000,121.602944354000,38.909348341000,121.603001354000,38.909337340000,121.603243350000,38.909424341000,121.603827339000,38.909583342000,121.604178563000,38.909661088000,121.604506334000,38.909095353000,121.604789334000,38.908607362000,121.604946334000,38.908379365000,121.605282334000,38.907884375000,121.605617334000,38.907393385000,121.605912335000,38.906961392000,121.606237333000,38.906484400000,121.606427333000,38.906205405000,121.606592334000,38.905989409000,121.606659333000,38.905902411000,121.606864334000,38.905599416000,121.606904334000,38.905540418000,121.607211333000,38.905088427000,121.607893332000,38.904080444000,121.607977331000,38.904116444000,121.609155308000,38.904628444000,121.609161526000,38.904619853000,121.609700308000,38.903875459000,121.609787308000,38.903704461000,121.610053310000,38.903125471000,121.610087310000,38.903029473000,121.610048316000,38.902542479000,121.609988324000,38.901792490000,121.610044325000,38.901591493000,121.610068326000,38.901503494000,121.610319324000,38.901295499000,121.610941316000,38.901108505000,121.611408310000,38.901005510000,121.611686307000,38.900943513000,121.611991303000,38.900797516000,121.612713735000,38.900388778000,121.612751296000,38.900367527000,121.612809296000,38.900329527000,121.613055924000,38.900169267000,121.613086293000,38.900149533000,121.613322938000,38.899969512000,121.613738289000,38.899653544000,121.614138284000,38.899466549000,121.614711278000,38.899239555000,121.615425269000,38.899079562000,121.615944262000,38.898959567000,121.615993262000,38.898948567000,121.616048672000,38.898932164000,121.616145260000,38.898903569000,121.616251259000,38.898872569000,121.616568256000,38.898671575000,121.616811255000,38.898348580000,121.617167255000,38.897938588000,121.617568252000,38.897520598000,121.617877251000,38.897188604000,121.619204245000,38.895777631000,121.619370244000,38.895588635000,121.619406245000,38.895548636000,121.619460246000,38.895299640000,121.619452254000,38.894448652000,121.619410272000,38.892765675000,121.619474273000,38.892509679000,121.619491274000,38.892439681000,121.619538273000,38.892355682000,121.619651274000,38.892199685000,121.619669274000,38.892171686000,121.620475269000,38.891387701000,121.620543269000,38.891327703000,121.620674849000,38.891215185000,121.620687055000,38.891204560000,121.621154264000,38.890815714000,121.621703261000,38.890298725000,121.623571041000,38.888519875000,121.623741249000,38.888357765000,121.624226247000,38.887896773000,121.624453246000,38.887687778000,121.624902242000,38.887479784000,121.625069963000,38.887446822000,121.625098229000,38.888435771000,121.625130227000,38.888557770000,121.625447219000,38.888864768000,121.625447219000,38.888865768000,121.625478216000,38.889111764000,121.625455214000,38.889429760000,121.625378212000,38.889705755000,121.625196212000,38.889966750000,121.625065206000,38.890065882000,121.625069792000,38.890422605000,121.625044927000,38.890502082000,121.624963850000,38.890761232000,121.624414817000,38.890880994000,121.624413129000,38.890968370000,121.624676300000,38.891495856000,121.625085860000,38.892464374000,121.625365514000,38.893125680000,121.625376800000,38.893186697000,121.625810669000,38.894813008000,121.627300348000,38.897464554000,121.628530583000,38.897756948000,121.628386681000,38.899057844000,121.628569201000,38.900654615000,121.626785909000,38.901909525000,121.626554741000,38.904749584000,121.626257525000,38.904287249000,121.625075009000,38.903369644000,121.624674912000,38.902680077000,121.624163987000,38.902862551000,121.623093477000,38.902570593000,121.622412244000,38.902375955000,121.622235614000,38.902682931000,121.622027070000,38.902844531000,121.621011312000,38.903471502000,121.620904764000,38.903544331000,121.620700695000,38.903662318000,121.620605992000,38.903784077000,121.620037781000,38.903770549000,121.619956608000,38.903872015000,121.620497762000,38.904014068000,121.620267772000,38.904670216000,121.619963373000,38.904852856000,121.619456041000,38.905028731000,121.618854008000,38.905272250000,121.618653294000,38.905696969000" } ], "datalen":1 }';
echo "123".$res;
	//$res = json_decode($res, true);
	if($res['code']=="1"){
		$result = array (
				'head' => array (
							'code' => $res['code'],
							'message' => ''
							),
				'value' => $res['data'],
				'extend' => ''
			);
	}else{
		$result = array (
				'head' => array (
							'code' => 0,
							'message' => $res['msg']
							),
				'value' => '',
				'extend' => ''
			);
	}
	echo json_encode($result, JSON_UNESCAPED_UNICODE);
?>